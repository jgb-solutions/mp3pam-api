"A datetime string with format `Y-m-d H:i:s`, e.g. `2018-01-01 13:00:00`."
scalar DateTime
	@scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

"A date string with format `Y-m-d`, e.g. `2011-05-23`."
scalar Date @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\Date")

# Protected Queries
type Query @middleware(checks: ["auth:api"]) {
	me: User! @auth
}

# Public Queries
extend type Query {
	# Auth
	login(input: LoginInput!): LoginPayload @field(resolver: "LoginQuery")

	# Tracks
	tracks(page: Int = 1): [Track!]! @paginate(defaultCount: 20)
	track(hash: Int! @eq): Track @find

	# Users
	users(page: Int = 1): [User!]! @paginate(defaultCount: 20)
	user(id: ID! @eq): User @find

	# Categories
	categories(
		page: Int = 1
		orderBy: [OrderByClause!] = [{ field: "name", order: ASC }] @orderBy
	): [Category!]! @paginate(defaultCount: 20)
	category(slug: String! @eq): Category @find

	# Artists
	artists(page: Int = 1): [Artist!]! @paginate(defaultCount: 20)
	artist(hash: ID @eq): Artist @find

	# Upload URL
	 uploadUrl(name: String!, type: String! @spread): UploadUrl! @field(resolver: "UploadUrlQuery")
}

type Mutation @middleware(checks: ["auth:api"]) {
	updateUser(id: ID!, name: String): User @update
	deleteUser(id: ID!): User @delete
}

extend type Mutation {
	register(input: RegisterInput! @spread): User! @create
}

type UploadUrl {
	signedUrl: String!,
	fileUrl: String!
}

input RegisterInput {
	name: String! @rules(apply: ["required", "string"])
	email: String! @rules(apply: ["required", "email"])
	password: String! @rules(apply: ["required", "min:6"]) @bcrypt
	telephone: String @rules(apply: ["string"])
}

input LoginInput {
	email: String! @rules(apply: ["required", "email"])
	password: String! @rules(apply: ["required", "min:6"])
}

type LoginPayload {
	user: User!
	token: String!
}

input OrderByClause {
	field: String!
	order: SortOrder!
}

enum SortOrder {
	ASC
	DESC
}

type User {
	id: ID!
	name: String!
	email: String!
	avatar: String!
	active: Boolean!
	tracks: [Track!]! @hasMany(type: "paginator", defaultCount: 20)
	telephone: String!
	created_at: DateTime!
	updated_at: DateTime!
}

type Artist {
	id: ID!
	name: String!
	stage_name: String!
	hash: Int!
	avatar: String!
	tracks: [Track!]
}

type Track {
	id: ID!
	title: String!
	hash: Int!
	file_name: String!
	image: String!
	featured: Boolean!
	detail: String!
	lyrics: String!
	created_at: DateTime!
	updated_at: DateTime!
	category: Category! @belongsTo
}

type Category {
	id: ID!
	name: String!
	slug: String!
	tracks: [Track!]! @hasMany(type: "paginator", defaultCount: 20)
}
